# Backend README

Проект — бэкенд на Flask + SQLAlchemy + GraphQL (Ariadne).

## Краткое описание

API реализовано как GraphQL сервер (используется Ariadne). Проект хранит информацию о пользователях, пациентах, сенсорах и истории использования сенсоров. Присутствует базовая HTTP Basic аутентификация и логирование действий.

## Требования

- Python 3.9+
- PostgreSQL
- pip

## Переменные окружения

- `SQLALCHEMY_DATABASE_URI` — строка подключения к базе данных PostgreSQL.

## Структура проекта

- `__init__.py` — инициализация Flask-приложения, SQLAlchemy, миграций и конфигурации `UPLOAD_FOLDER`.
- `auth.py` — реализация HTTP Basic-аутентификации.
- `common.py` — вспомогательные методы для формирования результатов ответов и декораторы.
- `models.py` — SQLAlchemy-модели.
- `mutations.py` — GraphQL мутации.
- `queries.py` — GraphQL запросы.
- `utils.py` — утилиты для расчётов и форматирования.
- `sensor_values_mock.py` — генератор мок-данных.

## Основные модели

- `Users` — пользователи (администраторы и врачи).
- `Patient` — пациенты.
- `Sensor` — сенсоры, привязанные к пациентам.
- `PatientTime` — время ношения сенсора.
- `Patient3dFile` — загруженные файлы 3D-моделей.
- `Log` — логи действий пользователей.

## Ошибки и формат ответов

Все успешные ответы имеют статус `true`, ошибки — `false` с кодами и сообщениями.

## Аутентификация

Используется `flask_httpauth` (HTTP Basic Auth). При успешной аутентификации возвращается идентификатор пользователя.

## GraphQL API

Сервер реализован с использованием Ariadne. Поддерживаются запросы и мутации для управления пользователями, пациентами, сенсорами и логами.

## Подсчёт времени ношения сенсора

Температурные показания считаются валидными, если находятся в пределах допустимого диапазона. Результаты агрегируются по датам и сохраняются в базу данных.

## Миграции

Проект использует `flask_migrate` (Alembic) для управления миграциями базы данных.

## Запуск проекта

1. Создать виртуальное окружение.
2. Установить зависимости.
3. Настроить переменные окружения.
4. Выполнить миграции.
5. Запустить приложение.

## Настройки загрузки файлов

Папка для загрузок указывается в `app.config['UPLOAD_FOLDER']`.

## Рекомендации по улучшению

- Хеширование паролей.
- Использование JWT вместо Basic Auth.
- Валидация входных данных.
- Ограничение размера загружаемых файлов.
- Расширенное логирование.
- Добавление тестов.

## Контакты и поддержка

Для получения дополнительной информации о методах, данных и деплое можно запросить документацию или дополнительные примеры.
